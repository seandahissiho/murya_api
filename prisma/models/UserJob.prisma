model UserJob {
  id                String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId            String                 @db.Uuid
  scope             UserJobScope           @default(JOB)
  jobId             String?                @db.Uuid
  jobFamilyId       String?                @db.Uuid
  status            UserJobStatus          @default(TARGET)
  // Optional: manual level or seniority (1–5 for example)
  note              String?                @db.Text
  // Aggregated stats for fast dashboards (optional but useful)
  totalScore        Int                    @default(0) // sum of all quiz totalScore
  maxScoreSum       Int                    @default(0) // sum of all quiz maxScore
  completedQuizzes  Int                    @default(0)
  lastQuizAt        DateTime?              @db.Timestamp(0)
  leagueTier        LeagueTier             @default(IRON)
  leaguePoints      Int                    @default(0) // points internes pour montée/descente
  lastLeagueChange  DateTime?              @db.Timestamp(0)
  winningStreak     Int                    @default(0) // nombre de quiz gagnés consécutivement
  createdAt         DateTime               @default(now()) @db.Timestamp(0)
  updatedAt         DateTime               @default(now()) @updatedAt @db.Timestamp(0)
  user              User                   @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  job               Job?                   @relation(fields: [jobId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  jobFamily         JobFamily?             @relation(fields: [jobFamilyId], references: [id], onUpdate: Cascade, onDelete: Cascade)
  selectedJobs      UserJobSelectedJob[]
  quizzes           UserQuiz[]
  competencies      UserJobCompetency[]
  learningResources LearningResource[]
  leagueHistories   UserJobLeagueHistory[]
  kiviats           UserJobKiviat[]
  userJobQuests     UserJobQuest[]

  @@unique([userId, jobId], map: "unique_user_job")
  @@unique([userId, jobFamilyId], map: "unique_user_job_family")
  @@index([userId], map: "idx_user_job_user")
  @@index([jobId], map: "idx_user_job_job")
  @@index([jobFamilyId], map: "idx_user_job_job_family")
  @@index([userId, status], map: "idx_user_job_user_status")
}
